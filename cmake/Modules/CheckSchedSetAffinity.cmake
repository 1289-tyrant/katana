include(CheckSymbolExists)

set(CMAKE_REQUIRED_DEFINITIONS -D_GNU_SOURCE)
check_symbol_exists(sched_setaffinity sched.h HAVE_SCHED_SETAFFINITY_INTERNAL)
if(HAVE_SCHED_SETAFFINITY_INTERNAL)
  set(SCHED_SETAFFINITY_FOUND "${HAVE_SCHED_SETAFFINITY_INTERNAL}")
  set(SCHED_SETAFFINITY_LIBRARIES)
else()
  set(CMAKE_REQUIRED_LIBRARIES "-lrt")
  check_symbol_exists(sched_setaffinity sched.h HAVE_SCHED_SETAFFINITY_RT_INTERNAL)
  if(HAVE_SCHED_SETAFFINITY_RT_INTERNAL)
    message(STATUS "sched_setaffinity found (in librt)")
    set(SCHED_SETAFFINITY_FOUND "${HAVE_SCHED_SETAFFINITY_RT_INTERNAL}")
    set(SCHED_SETAFFINITY_LIBRARIES rt)
  endif()
endif()
